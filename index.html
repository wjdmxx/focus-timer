<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸“æ³¨ä¸å†·é™è®¡æ—¶å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            transition: background-color 0.8s ease, color 0.8s ease;
            touch-action: manipulation;
        }

        .timer-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
            transition: background 0.8s ease;
        }

        .cooling-mode .timer-card {
            background: rgba(0, 0, 0, 0.2);
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
        }

        .digital-font {
            font-variant-numeric: tabular-nums;
            letter-spacing: -2px;
        }

        /* è„‰åŠ¨æ•ˆæœ */
        @keyframes pulse-red {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }

            70% {
                box-shadow: 0 0 0 20px rgba(239, 68, 68, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        .pulse {
            animation: pulse-red 2s infinite;
        }

        /* è®¡æ—¶é˜¶æ®µå‘¼å¸å…‰æ•ˆ - æŸ”å’Œæ¤­åœ†å…‰æ™• */
        .focus-glow {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        /* å››è§’æŸ”å’Œå…‰æ™• */
        .focus-glow::before,
        .focus-glow::after {
            content: '';
            position: absolute;
            width: 70vmax;
            height: 70vmax;
            border-radius: 50%;
            filter: blur(60px);
            animation: breathing-glow 2s ease-in-out infinite;
        }

        .focus-glow::before {
            top: -35vmax;
            left: -35vmax;
            background: radial-gradient(ellipse at center,
                    rgba(100, 200, 180, 0.3) 0%,
                    rgba(100, 200, 180, 0.15) 30%,
                    rgba(100, 200, 180, 0.05) 50%,
                    transparent 70%);
        }

        .focus-glow::after {
            bottom: -35vmax;
            right: -35vmax;
            background: radial-gradient(ellipse at center,
                    rgba(100, 200, 180, 0.3) 0%,
                    rgba(100, 200, 180, 0.15) 30%,
                    rgba(100, 200, 180, 0.05) 50%,
                    transparent 70%);
            animation-delay: -1s;
        }

        /* é¢å¤–ä¸¤ä¸ªè§’è½çš„å…‰æ™• */
        .glow-corner-tr,
        .glow-corner-bl {
            position: absolute;
            width: 60vmax;
            height: 60vmax;
            border-radius: 50%;
            filter: blur(50px);
            animation: breathing-glow 2s ease-in-out infinite;
        }

        .glow-corner-tr {
            top: -30vmax;
            right: -30vmax;
            background: radial-gradient(ellipse at center,
                    rgba(120, 210, 190, 0.25) 0%,
                    rgba(120, 210, 190, 0.1) 40%,
                    transparent 70%);
            animation-delay: -0.5s;
        }

        .glow-corner-bl {
            bottom: -30vmax;
            left: -30vmax;
            background: radial-gradient(ellipse at center,
                    rgba(80, 190, 170, 0.25) 0%,
                    rgba(80, 190, 170, 0.1) 40%,
                    transparent 70%);
            animation-delay: -1.5s;
        }

        @keyframes breathing-glow {

            0%,
            100% {
                opacity: 0.6;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.05);
            }
        }

        /* æ»‘åŠ¨æ¡æ ·å¼ */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            outline: none;
            transition: opacity 0.3s;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: #2563eb;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .config-input {
            width: 80px;
            text-align: center;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 6px 8px;
            font-size: 1rem;
            font-weight: 600;
            transition: border-color 0.2s, opacity 0.3s;
        }

        .config-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        /* é…ç½®é¡¹å®¹å™¨ */
        .config-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            transition: opacity 0.3s;
        }

        .config-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* è§¦å‘æŒ‰é’®æ ·å¼ - å¢åŠ é«˜åº¦ */
        .trigger-button {
            height: 60px;
            min-height: 60px;
        }

        /* ç¦ç”¨çŠ¶æ€æ ·å¼ */
        .config-disabled {
            opacity: 0.4;
            pointer-events: none;
        }

        /* éšæœºæŒ‰é’®å¼€å…³æ ·å¼ */
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .toggle-switch {
            position: relative;
            width: 56px;
            height: 28px;
            background: #e2e8f0;
            border-radius: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #8b5cf6;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active::after {
            transform: translateX(28px);
        }

        .toggle-label {
            font-weight: 600;
            color: #475569;
            font-size: 0.95rem;
        }

        /* å®Œæˆé¡µé¢æ—¶é—´çº¿æ ·å¼ */
        .timeline {
            position: relative;
            padding-left: 24px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
        }

        .timeline-item {
            position: relative;
            padding: 12px 0;
            padding-left: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 0 2px currentColor;
        }

        .timeline-item.focus::before {
            background: #3b82f6;
            color: #3b82f6;
        }

        .timeline-item.cooling::before {
            background: #ef4444;
            color: #ef4444;
        }

        .timeline-item.complete::before {
            background: #10b981;
            color: #10b981;
        }

        .timeline-content {
            background: rgba(255, 255, 255, 0.6);
            padding: 10px 14px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .timeline-label {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .timeline-time {
            font-weight: 700;
            font-size: 0.95rem;
            color: #475569;
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .summary-total {
            font-size: 1.1rem;
            font-weight: 700;
            color: #3b82f6;
        }

        /* éšæœºæ¨¡å¼é€‰æ‹©å™¨æ ·å¼ */
        .random-mode-selector {
            display: flex;
            gap: 12px;
            margin-top: 12px;
            justify-content: center;
        }

        .mode-btn {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mode-btn:hover {
            border-color: #8b5cf6;
            color: #8b5cf6;
        }

        .mode-btn.active {
            border-color: #8b5cf6;
            background: #8b5cf6;
            color: white;
        }

        .random-info {
            margin-top: 12px;
            padding: 10px 14px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 10px;
            font-size: 0.85rem;
            color: #6b7280;
            text-align: left;
            line-height: 1.5;
        }

        .random-info-hidden {
            display: none;
        }
    </style>
</head>

<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4">

    <!-- å‘¼å¸å…‰æ•ˆå±‚ -->
    <div id="focus-glow" class="focus-glow hidden">
        <div class="glow-corner-tr"></div>
        <div class="glow-corner-bl"></div>
    </div>

    <!-- é…ç½®é¡µé¢ -->
    <div id="config-container"
        class="max-w-md w-full timer-card rounded-[2rem] shadow-2xl p-8 text-center border border-white relative z-10">
        <h1 class="text-2xl font-bold mb-6 opacity-80">é…ç½®å®šæ—¶è®¾ç½®</h1>

        <!-- éšæœºæ¨¡å¼å¼€å…³ -->
        <div class="toggle-container">
            <span class="toggle-label">éšæœºæ¨¡å¼</span>
            <div id="random-toggle" class="toggle-switch"></div>
        </div>

        <!-- éšæœºæ¨¡å¼ç±»å‹é€‰æ‹©ï¼ˆæ™®é€š/EXï¼‰ -->
        <div id="random-mode-options" class="toggle-container random-info-hidden" style="flex-direction: column; gap: 8px;">
            <div class="random-mode-selector" style="width: 100%;">
                <button id="mode-normal" class="mode-btn active">æ™®é€š</button>
                <button id="mode-ex" class="mode-btn">EX</button>
            </div>
            <div id="random-info-normal" class="random-info">
                <strong>æ™®é€šéšæœºæ¨¡å¼ï¼š</strong><br>
                â€¢ åˆå§‹æ—¶é—´ï¼š10-20 åˆ†é’Ÿ<br>
                â€¢ å†·é™æœŸï¼š2-4 åˆ†é’Ÿ<br>
                â€¢ æ—¶é—´å€ç‡ï¼š1.5-3.0 å€
            </div>
            <div id="random-info-ex" class="random-info random-info-hidden">
                <strong>EXéšæœºæ¨¡å¼ï¼š</strong><br>
                â€¢ åˆå§‹æ—¶é—´ï¼š20-30 åˆ†é’Ÿ<br>
                â€¢ å†·é™æœŸï¼š1-2 åˆ†é’Ÿ<br>
                â€¢ æ—¶é—´å€ç‡ï¼š2-4 å€<br>
                â€¢ ç‰¹æ®Šè§„åˆ™ï¼šç¿»å€åä¸è¶³10åˆ†é’Ÿæ—¶ï¼Œè‡³å°‘15åˆ†é’Ÿ
            </div>
        </div>

        <!-- éšè—æ—¶é—´å¼€å…³ -->
        <div class="toggle-container">
            <span class="toggle-label">éšè—æ—¶é—´</span>
            <div id="hide-time-toggle" class="toggle-switch"></div>
        </div>

        <div id="config-items" class="space-y-5">
            <!-- åˆå§‹æ—¶é—´ -->
            <div class="config-item">
                <label class="text-sm font-semibold text-slate-600 text-left">åˆå§‹æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                <div class="config-row">
                    <input type="range" id="initial-time-slider" min="5" max="20" value="5" class="flex-1">
                    <input type="number" id="initial-time-input" value="5" class="config-input" step="1">
                </div>
            </div>

            <!-- å†·é™æœŸæ—¶é—´ -->
            <div class="config-item">
                <label class="text-sm font-semibold text-slate-600 text-left">å†·é™æœŸæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                <div class="config-row">
                    <input type="range" id="cooling-time-slider" min="1" max="10" value="3" class="flex-1">
                    <input type="number" id="cooling-time-input" value="3" class="config-input" step="1">
                </div>
            </div>

            <!-- æ—¶é—´å€ç‡ -->
            <div class="config-item">
                <label class="text-sm font-semibold text-slate-600 text-left">æ—¶é—´å€ç‡</label>
                <div class="config-row">
                    <input type="range" id="multiplier-slider" min="1.0" max="5.0" value="1.0" step="0.1"
                        class="flex-1">
                    <input type="number" id="multiplier-input" value="1.0" class="config-input" step="0.1">
                </div>
            </div>
        </div>

        <button id="confirm-btn"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl shadow-lg transform transition active:scale-95 text-lg mt-8">
            ç¡®è®¤å¹¶å¼€å§‹
        </button>
    </div>

    <!-- è®¡æ—¶é¡µé¢ -->
    <div id="timer-container"
        class="max-w-md w-full timer-card rounded-[2rem] shadow-2xl p-8 text-center border border-white hidden relative z-10">
        <div id="timer-display" class="digital-font text-8xl font-black my-8 text-slate-800">
            05:00
        </div>

        <div class="space-y-4">
            <button id="trigger-btn"
                class="w-full bg-white border-2 border-red-500 hover:bg-red-50 rounded-2xl shadow-md transform transition active:scale-95 hidden trigger-button">
            </button>
        </div>
    </div>

    <!-- å®Œæˆé¡µé¢ -->
    <div id="complete-container"
        class="max-w-md w-full timer-card rounded-[2rem] shadow-2xl p-8 text-center border border-white hidden relative z-10">
        <h1 class="text-2xl font-bold mb-6 opacity-80">ğŸ‰ è®¡æ—¶å®Œæˆ</h1>

        <div class="summary-header">
            <span class="text-slate-600 font-semibold">æ€»è®¡æ—¶é•¿</span>
            <span id="total-time" class="summary-total">00:00</span>
        </div>

        <div id="timeline" class="timeline text-left mb-6">
            <!-- æ—¶é—´çº¿å†…å®¹ç”± JS åŠ¨æ€ç”Ÿæˆ -->
        </div>

        <button id="restart-btn"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl shadow-lg transform transition active:scale-95 text-lg">
            é‡æ–°å¼€å§‹
        </button>
    </div>

    <script>
        // DOM å…ƒç´ 
        const configContainer = document.getElementById('config-container');
        const timerContainer = document.getElementById('timer-container');
        const completeContainer = document.getElementById('complete-container');
        const body = document.body;
        const timerDisplay = document.getElementById('timer-display');
        const triggerBtn = document.getElementById('trigger-btn');
        const confirmBtn = document.getElementById('confirm-btn');
        const restartBtn = document.getElementById('restart-btn');
        const randomToggle = document.getElementById('random-toggle');
        const configItems = document.getElementById('config-items');
        const focusGlow = document.getElementById('focus-glow');
        const timelineEl = document.getElementById('timeline');
        const totalTimeEl = document.getElementById('total-time');

        // æ–°å¢DOMå…ƒç´ 
        const hideTimeToggle = document.getElementById('hide-time-toggle');
        const randomModeOptions = document.getElementById('random-mode-options');
        const modeNormalBtn = document.getElementById('mode-normal');
        const modeExBtn = document.getElementById('mode-ex');
        const randomInfoNormal = document.getElementById('random-info-normal');
        const randomInfoEx = document.getElementById('random-info-ex');

        // æ»‘åŠ¨æ¡å’Œè¾“å…¥æ¡†
        const initialTimeSlider = document.getElementById('initial-time-slider');
        const initialTimeInput = document.getElementById('initial-time-input');
        const coolingTimeSlider = document.getElementById('cooling-time-slider');
        const coolingTimeInput = document.getElementById('cooling-time-input');
        const multiplierSlider = document.getElementById('multiplier-slider');
        const multiplierInput = document.getElementById('multiplier-input');

        // é…ç½®å€¼
        let config = {
            initialTime: 5,
            coolingTime: 3,
            multiplier: 1.0
        };

        // éšæœºæ¨¡å¼çŠ¶æ€
        let isRandomMode = false;
        let isExMode = false; // æ–°å¢ï¼šæ˜¯å¦ä¸ºEXæ¨¡å¼
        let isHideTimeMode = false; // æ–°å¢ï¼šæ˜¯å¦éšè—æ—¶é—´

        // è®¡æ—¶å™¨çŠ¶æ€
        let timeLeft = 0;
        let timerInterval = null;
        let isCoolingDown = false;
        let lastTaskRemainingTime = 0;
        let timerEnded = false; // æ–°å¢ï¼šæ ‡è®°è®¡æ—¶æ˜¯å¦å·²ç»“æŸï¼ˆç”¨äºéšè—æ—¶é—´æ¨¡å¼ï¼‰

        // è®°å½•è®¡æ—¶æµç¨‹
        let sessionHistory = [];
        let currentPhaseStartTime = 0;

        // éšæœºæ•°ç”Ÿæˆå‡½æ•°
        function randomInRange(min, max) {
            return Math.random() * (max - min) + min;
        }

        // éšæœºæ¨¡å¼åˆ‡æ¢
        randomToggle.addEventListener('click', () => {
            isRandomMode = !isRandomMode;
            randomToggle.classList.toggle('active', isRandomMode);
            configItems.classList.toggle('config-disabled', isRandomMode);
            
            // æ˜¾ç¤º/éšè—éšæœºæ¨¡å¼é€‰é¡¹
            if (isRandomMode) {
                randomModeOptions.classList.remove('random-info-hidden');
            } else {
                randomModeOptions.classList.add('random-info-hidden');
            }
        });

        // éšè—æ—¶é—´æ¨¡å¼åˆ‡æ¢
        hideTimeToggle.addEventListener('click', () => {
            isHideTimeMode = !isHideTimeMode;
            hideTimeToggle.classList.toggle('active', isHideTimeMode);
        });

        // æ™®é€š/EXæ¨¡å¼åˆ‡æ¢
        modeNormalBtn.addEventListener('click', () => {
            isExMode = false;
            modeNormalBtn.classList.add('active');
            modeExBtn.classList.remove('active');
            randomInfoNormal.classList.remove('random-info-hidden');
            randomInfoEx.classList.add('random-info-hidden');
        });

        modeExBtn.addEventListener('click', () => {
            isExMode = true;
            modeExBtn.classList.add('active');
            modeNormalBtn.classList.remove('active');
            randomInfoEx.classList.remove('random-info-hidden');
            randomInfoNormal.classList.add('random-info-hidden');
        });

        // åŒæ­¥æ»‘åŠ¨æ¡å’Œè¾“å…¥æ¡†
        function syncSliderInput(slider, input, isFloat = false) {
            slider.addEventListener('input', () => {
                input.value = isFloat ? parseFloat(slider.value).toFixed(1) : slider.value;
            });
            input.addEventListener('input', () => {
                const val = isFloat ? parseFloat(input.value) : parseInt(input.value);
                if (!isNaN(val)) {
                    // æ»‘åŠ¨æ¡é™åˆ¶åœ¨èŒƒå›´å†…ï¼Œä½†è¾“å…¥å€¼å¯ä»¥è¶…å‡º
                    const minVal = parseFloat(slider.min);
                    const maxVal = parseFloat(slider.max);
                    slider.value = Math.min(Math.max(val, minVal), maxVal);
                }
            });
        }

        syncSliderInput(initialTimeSlider, initialTimeInput);
        syncSliderInput(coolingTimeSlider, coolingTimeInput);
        syncSliderInput(multiplierSlider, multiplierInput, true);

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function formatTimeReadable(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            if (m > 0 && s > 0) {
                return `${m}åˆ†${s}ç§’`;
            } else if (m > 0) {
                return `${m}åˆ†é’Ÿ`;
            } else {
                return `${s}ç§’`;
            }
        }

        function updateUI() {
            // åˆ¤æ–­æ˜¯å¦éœ€è¦éšè—æ—¶é—´
            const shouldHideTime = isHideTimeMode && !isCoolingDown;
            
            if (shouldHideTime) {
                timerDisplay.textContent = '**:**';
            } else {
                timerDisplay.textContent = formatTime(timeLeft);
            }

            if (isCoolingDown) {
                body.className = "bg-red-600 min-h-screen flex items-center justify-center p-4 cooling-mode";
                timerDisplay.classList.add('text-white');
                timerDisplay.classList.remove('text-slate-800');
                triggerBtn.classList.add('hidden');
                focusGlow.classList.add('hidden');
            } else {
                body.className = "bg-slate-100 min-h-screen flex items-center justify-center p-4";
                timerDisplay.classList.remove('text-white');
                timerDisplay.classList.add('text-slate-800');

                if (timerInterval || timerEnded) {
                    triggerBtn.classList.remove('hidden');
                    focusGlow.classList.remove('hidden');
                } else {
                    triggerBtn.classList.add('hidden');
                    focusGlow.classList.add('hidden');
                }
            }
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            currentPhaseStartTime = timeLeft;
            timerEnded = false;

            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateUI();
                } else {
                    // è®¡æ—¶ç»“æŸ
                    if (isHideTimeMode && !isCoolingDown) {
                        // éšè—æ—¶é—´æ¨¡å¼ä¸‹ï¼Œè®¡æ—¶ç»“æŸååœæ­¢è®¡æ—¶ä½†ä¿æŒæ˜¾ç¤º**:**
                        clearInterval(timerInterval);
                        timerInterval = null;
                        timerEnded = true;
                        updateUI();
                    } else {
                        handleTimerEnd();
                    }
                }
            }, 1000);
            updateUI();
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            updateUI();
        }

        function recordPhase(type, duration) {
            sessionHistory.push({
                type: type, // 'focus' or 'cooling'
                duration: duration
            });
        }

        function handleTimerEnd() {
            // è®°å½•å½“å‰é˜¶æ®µ
            if (isCoolingDown) {
                recordPhase('cooling', currentPhaseStartTime);
            } else {
                recordPhase('focus', currentPhaseStartTime);
            }

            stopTimer();
            timerEnded = false;
            
            if (isCoolingDown) {
                // å†·é™æœŸç»“æŸ -> è¿›å…¥å€ç‡æ—¶é—´æ¨¡å¼
                isCoolingDown = false;

                // æ ¹æ®æ¨¡å¼ç¡®å®šå€ç‡
                let currentMultiplier = config.multiplier;
                if (isRandomMode) {
                    if (isExMode) {
                        // EXæ¨¡å¼ï¼š2-4å€
                        currentMultiplier = randomInRange(2.0, 4.0);
                    } else {
                        // æ™®é€šæ¨¡å¼ï¼š1.5-3.0å€
                        currentMultiplier = randomInRange(1.5, 3.0);
                    }
                }

                timeLeft = Math.round(lastTaskRemainingTime * currentMultiplier);
                
                // EXæ¨¡å¼ç‰¹æ®Šè§„åˆ™ï¼šç¿»å€åä¸è¶³10åˆ†é’Ÿæ—¶ï¼Œè‡³å°‘15åˆ†é’Ÿ
                if (isRandomMode && isExMode) {
                    if (timeLeft < 10 * 60 && timeLeft > 0) {
                        timeLeft = 15 * 60;
                    }
                }
                
                if (timeLeft > 0) {
                    startTimer();
                } else {
                    // å¦‚æœå€ç‡åæ—¶é—´ä¸º0ï¼Œç›´æ¥ç»“æŸ
                    showCompletePage();
                }
            } else {
                // è®¡æ—¶å®Œæˆï¼Œæ˜¾ç¤ºå®Œæˆé¡µé¢
                showCompletePage();
            }
        }

        function showConfigPage() {
            timerContainer.classList.add('hidden');
            completeContainer.classList.add('hidden');
            configContainer.classList.remove('hidden');
            focusGlow.classList.add('hidden');
            body.className = "bg-slate-100 min-h-screen flex items-center justify-center p-4";
        }

        function showTimerPage() {
            configContainer.classList.add('hidden');
            completeContainer.classList.add('hidden');
            timerContainer.classList.remove('hidden');
        }

        function showCompletePage() {
            timerContainer.classList.add('hidden');
            configContainer.classList.add('hidden');
            completeContainer.classList.remove('hidden');
            focusGlow.classList.add('hidden');
            body.className = "bg-slate-100 min-h-screen flex items-center justify-center p-4";

            renderTimeline();
        }

        function renderTimeline() {
            let html = '';
            let totalSeconds = 0;

            sessionHistory.forEach((item, index) => {
                totalSeconds += item.duration;
                const typeClass = item.type === 'focus' ? 'focus' : 'cooling';
                const typeLabel = item.type === 'focus' ? 'â±ï¸ ä¸“æ³¨' : 'ğŸ˜Œ å†·é™';
                const labelColor = item.type === 'focus' ? 'text-blue-600' : 'text-red-500';

                html += `
                    <div class="timeline-item ${typeClass}">
                        <div class="timeline-content">
                            <span class="timeline-label ${labelColor}">${typeLabel}</span>
                            <span class="timeline-time">${formatTimeReadable(item.duration)}</span>
                        </div>
                    </div>
                `;
            });

            // æ·»åŠ å®Œæˆæ ‡è®°
            html += `
                <div class="timeline-item complete">
                    <div class="timeline-content">
                        <span class="timeline-label text-green-600">âœ… å®Œæˆ</span>
                        <span class="timeline-time"></span>
                    </div>
                </div>
            `;

            timelineEl.innerHTML = html;
            totalTimeEl.textContent = formatTimeReadable(totalSeconds);
        }

        // ç¡®è®¤é…ç½®å¹¶å¼€å§‹
        confirmBtn.addEventListener('click', () => {
            // é‡ç½®å†å²è®°å½•
            sessionHistory = [];
            timerEnded = false;

            if (isRandomMode) {
                if (isExMode) {
                    // EXæ¨¡å¼ï¼šåˆå§‹æ—¶é—´ 20-30 åˆ†é’Ÿ
                    config.initialTime = randomInRange(20, 30);
                } else {
                    // æ™®é€šéšæœºæ¨¡å¼ï¼šåˆå§‹æ—¶é—´éšæœº 10-20 åˆ†é’Ÿ
                    config.initialTime = randomInRange(10, 20);
                }
                // å†·å´æ—¶é—´å’Œå€ç‡ä¸åœ¨è¿™é‡Œè®¾ç½®ï¼Œè€Œæ˜¯åœ¨æ¯æ¬¡è§¦å‘æ—¶éšæœº
            } else {
                // å›ºå®šæ¨¡å¼ï¼šè¯»å–é…ç½®
                config.initialTime = parseFloat(initialTimeInput.value) || 5;
                config.coolingTime = parseFloat(coolingTimeInput.value) || 3;
                config.multiplier = parseFloat(multiplierInput.value) || 1.0;

                // ç¡®ä¿å€¼ä¸ºæ­£æ•°
                config.initialTime = Math.max(0.1, config.initialTime);
                config.coolingTime = Math.max(0.1, config.coolingTime);
                config.multiplier = Math.max(0.1, config.multiplier);
            }

            // åˆå§‹åŒ–è®¡æ—¶
            timeLeft = Math.round(config.initialTime * 60);
            isCoolingDown = false;
            lastTaskRemainingTime = 0;

            // åˆ‡æ¢åˆ°è®¡æ—¶é¡µé¢
            showTimerPage();
            startTimer();
        });

        // æ ¸å¿ƒé€»è¾‘ï¼šè§¦å‘å†·é™æœŸ / éšè—æ—¶é—´æ¨¡å¼ä¸‹çš„æŒ‰é’®å¤„ç†
        triggerBtn.addEventListener('click', () => {
            // éšè—æ—¶é—´æ¨¡å¼ä¸‹ï¼Œå¦‚æœè®¡æ—¶å·²ç»“æŸï¼Œåˆ™è¿›å…¥ç»“ç®—
            if (isHideTimeMode && !isCoolingDown && timerEnded) {
                // è®°å½•ä¸“æ³¨é˜¶æ®µ
                recordPhase('focus', currentPhaseStartTime);
                timerEnded = false;
                // è®¡æ—¶å®Œæˆï¼Œæ˜¾ç¤ºå®Œæˆé¡µé¢
                showCompletePage();
                return;
            }

            // è®°å½•ä¸“æ³¨é˜¶æ®µï¼ˆå®é™…ä½¿ç”¨çš„æ—¶é—´ = åˆå§‹æ—¶é—´ - å‰©ä½™æ—¶é—´ï¼‰
            const usedTime = currentPhaseStartTime - timeLeft;
            if (usedTime > 0) {
                recordPhase('focus', usedTime);
            }

            // 1. è®°å½•å½“å‰å‰©ä½™æ—¶é—´
            lastTaskRemainingTime = timeLeft;

            // 2. åˆ‡æ¢çŠ¶æ€
            isCoolingDown = true;
            timerEnded = false;

            // 3. è®¾ç½®å†·é™æœŸæ—¶é—´
            let coolingTime;
            if (isRandomMode) {
                if (isExMode) {
                    // EXæ¨¡å¼ï¼š1-2åˆ†é’Ÿ
                    coolingTime = randomInRange(1, 2);
                } else {
                    // æ™®é€šæ¨¡å¼ï¼š2-4åˆ†é’Ÿ
                    coolingTime = randomInRange(2, 4);
                }
            } else {
                coolingTime = config.coolingTime;
            }
            timeLeft = Math.round(coolingTime * 60);

            // 4. é‡å¯è®¡æ—¶å¾ªç¯
            startTimer();
        });

        // é‡æ–°å¼€å§‹æŒ‰é’®
        restartBtn.addEventListener('click', () => {
            showConfigPage();
        });
    </script>
</body>

</html>
